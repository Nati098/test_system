<!DOCTYPE html>
<html lang="ru">
  <head>
    <meta charset="UTF-8">
    <title>Choose test to pass:</title>
    <!-- Stylesheets -->
    <link rel="stylesheet" href="./styles.css">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <!-- Material Design Bootstrap -->
    <link rel="stylesheet" href="css/mdb.min.css">

    <!-- Scripts -->
    <script src="https://kit.fontawesome.com/85609d285c.js" crossorigin="anonymous"></script>
    <!-- jQuery, Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <!-- You can also require other files to run in this process -->
    <script src="./renderer.js"></script>

  </head>
  <body>

    <!-- Main page -->
    <div id="main" class="wrapper-editor">

      <h4>Добро пожаловать!</h4>
      <p>Для продолжения жми кнопку:</p>
      <a role="button" class="btn btn-outline-orange" onclick="onLoadBtnClick()">Загрузить<i class="fas fa-desktop pl-1"></i></a>
      <p> </p>

      <table class="table table-striped table-bordered" cellspacing="0" width="100%">
        <thead>
        <tr>

          <th class="th-sm" style="size: 20px; text-align: center"><b>#</b></th>
          <th class="th-sm" style="size: 20px; text-align: center"><b>Курс</b></th>
          <th class="th-sm" style="size: 20px; text-align: center"><b>Тест</b></th>

        </tr>
        </thead>
        <tbody  id="all-courses-table-list">
        <!-- List of tests -->
        </tbody>

      </table>

    </div>

    <!-- Test page -->
    <div id="test" style="display: none">

      <a role="button" onclick="togglePage('MAIN_PAGE')" class="btn btn-outline-indigo">Назад<i class="fas fa-backward pl-1"></i></a>

      <div id="mainInfo" class="table-responsive text-nowrap">
        <table id="questions" class="table table-borderless" cellspacing="0" >
          <tr>
            <td class="questionsTd">
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text">Курс:</span>
                </div>
                <input id="course-name-field" class="form-control" type="text" aria-label="Default" aria-describedby="inputGroup-sizing-default" value="Здесь будет название курса" readonly>
              </div>

              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text">ФИО</span>
                </div>
                <input id="fio-input" class="form-control" type="text" aria-label="Default" aria-describedby="inputGroup-sizing-default">
              </div>

            </td>

            <td class="questionsTd" style="width:1px; white-space:nowrap;">
              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text">Название теста:</span>
                </div>
                <input id="test-name-field" class="form-control" type="text" aria-label="Default" aria-describedby="inputGroup-sizing-default" value="Здесь будет название теста" readonly>
              </div>

              <div class="input-group mb-3">
                <div class="input-group-prepend">
                  <span class="input-group-text">Группа</span>
                </div>
                <input id="group-input" class="form-control" type="text" aria-label="Default" aria-describedby="inputGroup-sizing-default">
              </div>
            </td>

          </tr>

        </table>

      </div>

      <!--here the list of questions-->
      <div id="list-questions" class="list-group">

      </div>


      <br>
      <button type="button" class="btn btn-outline-indigo" data-toggle="modal" data-target="#result">Завершить тест</button>

      <div id="result" class="modal fade" role="dialog">
        <div class="modal-dialog modal-sm">

          <!-- Modal content-->
          <div class="modal-content">
            <div class="modal-header">
              <h4 class="modal-title">Результат</h4>
            </div>
            <div class="modal-body">
              <p>Вы прошли тест!</p>
              <p>Ваш результат: Х %</p>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-outline-indigo" data-dismiss="modal">ОК</button>
            </div>
          </div>

        </div>
      </div>

    </div>

  </body>
</html>


<script>
  let globalCourses = [
    {
      "courseName": "Математич процессы",
      "courseId": "course1",
      "tests": [
        {
          "testName": "testNo1",
          "testId": "test1",
          "questions": [
            {
              "questionId": "question1",
              "questionName": "How are you?",
              "cost": 10,
              "answers": [
                {
                  "answerId": "answer1",
                  "answerName": "qwe",
                  "right": true,
                },
                {
                  "answerId": "answer2",
                  "answerName": "rty",
                  "right": false,
                },
                {
                  "answerId": "answer3",
                  "answerName": "asd",
                  "right": false,
                },
              ]
            },
            {
              "questionId": "question2",
              "questionName": "How qweqweqwe you?",
              "cost": 11,
              "answers": [
                {
                  "answerId": "answer1",
                  "answerName": "qwe",
                  "right": true,
                },
                {
                  "answerId": "answer2",
                  "answerName": "rty",
                  "right": false,
                },
                {
                  "answerId": "answer3",
                  "answerName": "asd",
                  "right": false,
                },
              ]
            },
            {
              "questionId": "question3",
              "questionName": "QQyou?",
              "cost": 100,
              "answers": [
                {
                  "answerId": "answer1",
                  "answerName": "qwe",
                  "right": true,
                },
                {
                  "answerId": "answer2",
                  "answerName": "rty",
                  "right": false,
                },
                {
                  "answerId": "answer3",
                  "answerName": "asd",
                  "right": false,
                },
              ]
            },
          ]
        },
        {
          "testName": "testNo2",
          "testId": "test2",
          "questions": [
            {
              "questionId": "question2",
              "questionName": "How are qweqwe?",
              "cost": 5,
              "answers": [
                {
                  "answerId": "answer1",
                  "answerName": "qwe",
                  "right": true,
                },
                {
                  "answerId": "answer2",
                  "answerName": "rty",
                  "right": false,
                },
                {
                  "answerId": "answer3",
                  "answerName": "asd",
                  "right": false,
                },
              ]
            },
          ]
        }
      ]
    },
    {
      "courseName": "Физические процессы",
      "courseId": "course2",
      "tests": [
        {
          "testName": "testNo3",
          "testId": "test1",
          "questions": [
            {
              "questionId": "question3",
              "questionName": "ЦРФФФЕ",
              "cost": 10,
              "answers": [
                {
                  "answerId": "answer1",
                  "answerName": "qwe",
                  "right": true,
                },
                {
                  "answerId": "answer2",
                  "answerName": "rty",
                  "right": false,
                },
                {
                  "answerId": "answer3",
                  "answerName": "asd",
                  "right": false,
                },
              ]
            },
          ]
        },
        {
          "testName": "testNo2",
          "testId": "test2",
          "questions": [
            {
              "questionId": "question4",
              "questionName": "Hoуауаукпму",
              "cost": 5,
              "answers": [
                {
                  "answerId": "answer1",
                  "answerName": "qwe",
                  "right": true,
                },
                {
                  "answerId": "answer2",
                  "answerName": "rty",
                  "right": false,
                },
                {
                  "answerId": "answer3",
                  "answerName": "asd",
                  "right": false,
                },
              ]
            },
          ]
        }
      ]
    }
  ];

  let currentCourseIndex = -1;
  let currentTestIndex = -1;

  function onLoadBtnClick() {
    // TODO: load btn
    console.log('Load!');
  }

  function fillAllCoursesListTable() {
    let allTestsListTable = $("#all-courses-table-list");
    allTestsListTable.empty();

    globalCourses.forEach((value1, index1) => {
      let i = 1;

      value1.tests.forEach((value2, index2) => {
        let index = index1+''+index2;
        console.log('index='+index);

        let newRow = $('<tr id="' + i + '">');
        let cols = "";
        // cols += '<th scope="row" style="text-align: center">'+$tableID.find('tr').length+'</th>';
        cols += '<td style="text-align:center">' + value1.courseName + '</td>';
        cols += '<td style="text-align:center">' + value2.testName + '</td>';
        cols += '<td style="text-align:center">\n' +
                '   <span>\n' +
                '      <a role="button" class="btn row-run btn-outline-indigo btn-sm m-0" onclick="runTest(\'' + index + '\');">Пройти тест</a>\n' +
                '   </span>\n' +
                '</td>';
        cols += '</tr>';

        newRow.append(cols);
        allTestsListTable.append(newRow);
        i = i+1;
      });
    });

    togglePage("MAIN_PAGE");
  }

  function runTest(rowIdx) {

    let test = getTest(rowIdx);

    if (test === undefined) {
      console.log('Wrong test index. Current index: '+rowIdx);
    }

    fillTest(test);
    togglePage("TEST_PAGE");

  }

  function getTest(rowIdx) {
    let courseId = parseInt(rowIdx[0]);
    let testId = parseInt(rowIdx[1]);
    console.log('row idx='+rowIdx);
    console.log('course='+courseId+' tst='+testId);

    if (courseId > -1 && courseId < globalCourses.length) {
      if (testId > -1 && testId < globalCourses[courseId].tests.length) {
        currentCourseIndex = courseId;
        currentTestIndex = testId;
        console.log(globalCourses[courseId].tests[testId]);
        return globalCourses[courseId].tests[testId]
      }
    }
    return undefined
  }

  function fillTest(test) {
    $('#course-name-field').val(globalCourses[currentCourseIndex].courseName);
    $('#test-name-field').val(globalCourses[currentCourseIndex].tests[currentTestIndex].testName);

    let questionsList = $('#list-questions');
    questionsList.empty();

    test.questions.forEach((value1, index1) => {
      let element = '';

      element += '<div class="list-group-item">';
      element += '<h5 id="questionNumber">Вопрос '+(index1+1)+'</h5>';
      element += '<p id="questionName">'+value1.questionName+'</p>';
      element += '<div id="answers'+index1+'">';

      value1.answers.forEach((value2, index2) => {
        let index = 'answer'+index1+''+index2;
        let answer = '';

        answer += '<div class="form-check">';
        answer += '<input id="'+index+'" name="question'+index1+'" class="form-check-input" type="radio">';
        answer += '<label class="form-check-label" for="'+index+'">'+value2.answerName+'</label>';
        answer += '</div>';

        element += answer;
      });

      element += '</div>';
      element += '</div>';

      questionsList.append(element);
    });

  }

  function backToTests() {
    $('#course-name-field').val('');
    $('#test-name-field').val('');

    togglePage("MAIN_PAGE");
  }

  function togglePage(page) {
    if (page === "MAIN_PAGE") {
      $('#main').show();
      $('#test').hide();
      return;
    }

    if (page === "TEST_PAGE") {
      $('#main').hide();
      $('#test').show();
      return;
    }

  }

  fillAllCoursesListTable();
  togglePage("MAIN_PAGE");

</script>